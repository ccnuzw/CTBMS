这是一份融合了您认可的**“四类信息分类策略”**与**“系统化/AI自动化流转”**的最终版完整业务规划书。

这份文档的设计核心在于：保留对复杂商情（标品与非标品）的细腻分类，但在流转和管理环节，**剥离人为干预，让系统和AI算法承担“管家”和“初筛员”的角色**，实现高效运转。

---

# 粮食商情情报决策系统（GMIDSS）业务功能规划书
**—— AI驱动与全自动化管理版**

## 1. 建设目标
构建一套**“全源宽口径采集、AI智能治理、自动化闭环管理”**的商情中台。
系统旨在兼容粮食行业复杂的非标数据（PDF/图片/传闻），通过AI技术辅助一线人员快速录入，并由系统自动完成清洗、归类和考核，消除中间人为审核环节，打造企业级的“情报资产库”。

---

## 2. 核心数据模型：智能商情卡片 (Smart Info-Card)
统一“商情卡片”为唯一载体，但在后台增加AI处理层。

*   **基础层（人工输入）**：内容、附件、位置、基础分类。
*   **AI增强层（系统生成）**：
    *   **智能摘要**：AI自动读取长文/附件生成的结论。
    *   **语义标签**：系统分析内容后打上的标签（如 `#看涨` `#物流阻断`）。
    *   **质量评分**：系统算法算出的可信度分值。

---

## 3. 信息分类与“AI + 规则引擎”双轨采集策略
采用 **“双轨制” (Dual-Track)** 处理逻辑：对于简单的关键词和固定格式，使用**规则引擎 (Rule Engine)** 进行确定性提取，确保100%准确；对于复杂的自然语言和非标内容，使用 **AI 大模型** 进行模糊推理和摘要。

### 3.1 规则引擎：确定性“金标准” (Deterministic Rules)
*   **定位**：系统内置的“硬逻辑”，优先级高于AI。
*   **工作机制**：
    *   **关键词锚定**：例如，检测到“锦州港 + 停收”，规则引擎直接触发`PORT_STOPPED`事件，无需消耗AI Token。
    *   **上下文关联**：支持`SAME_SENTENCE`（同句）或`PRECEDED_BY`（前序）等逻辑。例如，只有当“价格”前面出现“潮粮”二字时，才将其归类为“潮粮收购价”。
    *   **零幻觉**：规则提取的数据被标记为 `High Confidence` (可信度100%)，直接进入核心数据库。

### 3.2 AI 增强层：处理非标“长尾” (Generative AI)
*   **定位**：处理规则无法覆盖的复杂场景。
*   **配置化能力**：AI模型参数（API Key, Model ID）现已实现**全动态配置**，可根据业务需求随时切换不同的模型（如从 Gemini Pro 切换到 Ultra，或切换到私有化部署模型）。


### 3.1 A类：标准化硬数据（Structured Data）
*   **内容定义**：价格（挂牌/折标）、库存量、排队车辆数、开机率。
*   **双轨治理流程**：
    1.  **规则优先**：OCR识别出的表格数据，首先通过规则引擎比对“标准字段库”。
    2.  **异常阻断**：规则引擎实时校验数值范围。例如，某地玉米均价2800，若填报280，规则直接拦截提示“数值异常”。
    3.  **AI 兜底**：对于无法用规则匹配的备注列（如“水分偏高拒收”），交由AI提取语义标签。

### 3.2 B类：半结构化情报（Semi-structured Intelligence）
*   **内容定义**：市场心态、天气影响、物流动态、突发传闻。
*   **双轨治理流程**：
    1.  **语音转文本**：一线业务员的语音输入首先被转录为文字。
    2.  **规则提取**：系统扫描文本中的实体（如“锦州港”）和高频动作（如“下雨”）。如果命中预设规则，直接生成结构化事件。
    3.  **AI 深度分析**：规则未能覆盖的部分（如“大家普遍觉得后市不乐观”），由AI进行情感分析 (Sentiment Analysis)，打上 `#看跌` `#情绪低落` 标签。

### 3.3 C类：文档与图表类信息（File & Document）
*   **内容定义**：红头文件(PDF)、行业研报(Word)、竞对报表(Excel/图片)。
*   **AI 辅助采集与治理**：
    *   **强制摘要 -> AI代劳**：上传文件的同时，AI大模型在后台自动阅读文件，生成一段“核心结论摘要”展示在输入框中。员工既可以直接提交，也可以进行修改。**（解决了员工懒得写摘要，导致文件无法检索的痛点）**
    *   **全文索引**：系统对所有PDF和图片进行OCR识别，使得用户在搜索框输入“补贴”时，能搜到图片里的文字内容。

### 3.4 D类：实体档案信息（Entity Profile）
*   **内容定义**：客户/供应商的基础画像、信用记录、硬件设施参数。
*   **AI 辅助采集与治理**：
    *   **自动命名实体识别（NER）**：当员工在A/B类信息中提到“金玉米”或“益海嘉里”时，系统自动识别并建立关联。
    *   **档案动态更新**：系统自动将上述关联到的价格、停机信息聚合到该企业的档案页下，形成动态的“企业生命周期记录”，无需人工专门维护档案。

---

## 4. 自动化业务流转（无人工审核模式）

取消“区域经理/部门主管”的人工审核节点，依靠规则引擎和算法进行流转。

### 步骤一：端侧采集与实时校验
*   **场景**：业务员手机端提交。
*   **系统动作**：
    *   **格式自检**：检查必填项、附件是否损坏。
    *   **逻辑自检**：触发A类信息的“异常值阻断”规则。
*   **结果**：不合格直接驳回修改，合格即进入系统。

### 步骤二：中台智能处理流水线 (Intelligent Processing Pipeline)
信息进入系统后，执行以下标准作业程序：

1.  **配置加载**：系统从数据库动态加载当前的 AI 模型配置与规则集。
2.  **规则引擎扫描 (Level 1 Processing)**：
    *   优先扫描文本中的“实体引用”（如企业名、地名）和“关键动作”。
    *   命中规则的内容直接生成标准事件，标注 `Source: RuleEngine`。
3.  **AI 深度推理 (Level 2 Processing)**：
    *   将剩余文本和规则提取结果作为 Prompt 上下文，发送给 AI 模型。
    *   AI 负责生成摘要、情感评分、以及提取规则遗漏的隐性信息。
4.  **结果融合 (Result Fusion)**：
    *   系统将“规则提取的硬数据”与“AI 提取的软信息”进行合并。
    *   若两者冲突，以规则引擎结果为准（人工定义的规则拥有最高解释权）。

### 步骤三：应用层输出
*   **对于分析师**：无需再做“搬运工”。系统提供“日报生成器”，自动聚合今日各地区价格涨跌幅、高频关键词（如“惜售”），生成日报底稿。
*   **对于决策者**：通过BI仪表盘查看实时数据，点击任意异常点可下钻查看原始商情卡片。

---

## 5. 系统化管理与考核体系

用代码规则代替人情管理，确保填报的及时性和准确性。

### 5.1 时效性管理（系统自动盯人）
*   **任务推送与倒计时**：系统每日自动下发任务（如：早9点前上报报价）。APP端显示倒计时，超时未报，系统自动记录违规。
*   **地理围栏打卡**：针对需要“跑现场”的信息，系统自动比对GPS数据。若人在家里编造现场数据，系统提示“位置异常”并禁止提交。

### 5.2 准确性与质量评分（算法打分）
系统对每一条商情卡片进行自动化评分（0-100分）：
*   **完整度得分**：有文字+有图+有定位 = 高分；仅有文字 = 低分。
*   **稀缺性得分**：同区域第一条上报的信息 = 高分；后续跟风上报 = 低分（鼓励抢首发）。
*   **验证得分（后验机制）**：
    *   对于价格数据，系统一周后回测市场均价，偏差越小，该员工的“信誉系数”越高。
    *   对于预测性情报（如“预测明日涨价”），若次日真的涨了，系统自动给予额外奖励分。

### 5.3 贡献度排名（排行榜）
*   系统自动生成月度榜单：
    *   **勤奋榜**：提交数量。
    *   **规则贡献榜**：当员工提交的信息高频命中“高价值规则”（如停机、涨价）时，获得额外加分。
    *   **价值榜**：被日报引用次数、被高层点赞次数。

---

## 6. 归档与检索：企业商情知识库

利用AI能力解决“非标信息难找”的问题。

1.  **全景搜索框**：
    *   支持模糊搜索。输入“东北大豆 停机”，系统能同时列出：
        *   历史价格表（Excel数据）
        *   现场停机通知照片（图片OCR内容）
        *   相关分析报告（PDF摘要）
2.  **自动标签云**：
    *   通过对海量历史数据的分析，系统自动生成“热门话题”。例如点击 `#环保检查` 标签，瞬间拉出过去三年所有因环保导致的停机记录，辅助判断此次检查的影响周期。

---

## 7. 全链路智能处理流程 (End-to-End Pipeline)

本章节描述一条非标信息（如语音、文本、图片）从录入到最终沉淀为数据资产的完整技术流转过程。

### 7.1 系统处理流程图

```mermaid
graph TD
    %% 阶段1：接入与预处理
    User[用户端 (App/Web)] -->|1. 提交信息 DTO| Controller[接入层 Controller]
    Controller -->|2. 格式校验 & 配置加载| ConfigService[配置中心]
    ConfigService -->|返回 AI模型参数 & 规则集| Controller
    
    %% 阶段2：双轨智能分析
    Controller -->|3. 启动分析任务| Pipeline[智能处理流水线]
    
    subgraph CoreEngine [核心分析引擎]
        direction TB
        Pipeline -->|Level 1| RuleEngine[规则引擎 Service]
        RuleEngine -->|3.1 确定性提取| RuleResult[规则提取结果 (High Confidence)]
        
        Pipeline -->|Level 2| AIService[AI 大模型 Service]
        RuleResult -.->|作为上下文输入| AIService
        AIService -->|3.2 深度推理| AIResult[AI 分析结果 (JSON)]
        
        AIResult & RuleResult -->|3.3 结果融合| Fusion[数据融合层]
        Fusion -->|冲突仲裁| FinalData[标准化中间态数据]
    end
    
    %% 阶段3：持久化与关联
    FinalData -->|4. 数据分发| Storage[存储层 Service]
    
    subgraph Persistence [数据持久化]
        Storage -->|写入| TB_Intel[主表: MarketIntel]
        
        Storage -->|拆解 A类| TB_Price[子表: PriceData]
        Storage -->|拆解 B类| TB_Event[子表: MarketEvent]
        Storage -->|拆解 C类| TB_Insight[子表: MarketInsight]
    end
    
    %% 阶段4：资产链接
    TB_Price & TB_Event -->|5. 自动链接| CP_Link[采集点档案 (CollectionPoint)]
    CP_Link -.->|资产归属| Master_Enterprise[企业主数据]
    
    %% 阶段5：反馈循环
    Storage -->|6. 更新积分| UserStats[用户画像统计]
```

### 7.2 详细处理步骤说明

#### 第一阶段：接入与预处理 (Ingestion)
1.  **动态配置加载**：请求到达时，系统首先从数据库读取最新的 `AIConfig`（包括当前启用的模型版本、API Key）和 `ExtractionRules`（提取规则库），确保处理逻辑实时更新，无需重启服务。
2.  **缓存预热**：系统校检“采集点缓存”和“事件类型缓存”，确保后续的实体链接操作是在内存中进行，极大降低数据库 IO。

#### 第二阶段：双轨混合分析 (Hybrid Analysis)
这是系统的核心大脑，由两个并行的引擎协同工作：
1.  **Level 1：规则引擎 (The "Sniper")**
    *   **任务**：负责“精准打击”。扫描文本中符合正则表达式的数值、同义词库中的地名（如“锦州港”、“深加工”）。
    *   **输出**：生成置信度为 100% 的锚点数据。例如，规则引擎明确匹配到了“水分 15%”，这个数据将被锁定，AI 无权修改。
2.  **Level 2：生成式 AI (The "Professor")**
    *   **任务**：负责“阅读理解”。处理自然语言的模糊地带，如“情绪分析”、“隐晦的后市预判”以及“非标准格式的价格”。
    *   **上下文**：规则引擎的提取结果会被作为 Prompt 的一部分喂给 AI，告诉 AI：“这些数据无论你怎么想，必须保留”。
3.  **结果融合 (Fusion)**
    *   系统将两者的结果合并。如果 AI 提取的价格与规则提取的冲突，以**规则引擎**为准（人工规则拥有最高解释权）。

#### 第三阶段：结构化沉淀 (Persistence)
分析完成后的 JSON 结果被拆解为关系型数据：
1.  **原子化拆分**：
    *   **A类**数据被写入 `PriceData` 表（用于画 K 线图）。
    *   **B类**数据被写入 `MarketEvent` 表（用于画时间轴）。
2.  **智能实体链接 (Entity Linking)**：
    *   每一条价格和事件，都会尝试寻找其物理归属——**采集点 (CollectionPoint)**。
    *   系统自动计算数据与“锦州港”或“北良港”的关联度，并在数据库层面建立外键约束。这意味着，当你打开“锦州港”的档案页时，可以看到刚刚录入的这条信息。

#### 第四阶段：反馈与闭环 (Feedback)
1.  **画像更新**：数据入库成功后，提交者的“准确率”和“贡献度”实时更新。
2.  **触发警报**：如果信息中包含高风险标签（如 `#停工`），系统立即触发 WebSocket 推送，弹窗通知决策层。

---

### 方案总结
这套方案通过**“AI辅助录入”**解决了非标信息难收集的问题，通过**“系统自动化流转与考核”**解决了人工管理成本高、人情分干扰的问题。它是一套“重两头、轻中间”的现代化情报系统：
*   **前端**：极简操作，语音/拍照即可。
*   **后端**：强大处理，自动清洗、关联、评分。
*   **中间**：零人工，完全由规则引擎驱动。