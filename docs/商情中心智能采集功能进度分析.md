# å•†æƒ…ä¸­å¿ƒæ™ºèƒ½é‡‡é›†åŠŸèƒ½ - è¿›åº¦åˆ†ææŠ¥å‘Š

> **åˆ†ææ—¥æœŸ**: 2026-01-19
> **æœ€åæ›´æ–°**: 2026-01-22
> **æ¨¡å—è·¯å¾„**: `apps/web/src/features/market-intel` (å‰ç«¯) / `apps/api/src/modules/market-intel` (åç«¯)

---

## ğŸ“Š æ€»ä½“å®Œæˆåº¦è¯„ä¼°

| åŠŸèƒ½åŸŸ | å®Œæˆåº¦ | çŠ¶æ€ |
| :--- | :---: | :--- |
| **æ•°æ®æ¨¡å‹ (Prisma Schema)** | 100% | âœ… å®Œæˆ |
| **åç«¯ API æ¥å£** | 95% | âœ… å®Œæˆ |
| **å‰ç«¯ API Hooks** | 95% | âœ… å®Œæˆ |
| **UI ç»„ä»¶** | 90% | âœ… åŸºæœ¬å®Œæˆ |
| **AI æ™ºèƒ½åˆ†æ** | 85% | âœ… Gemini API å·²é›†æˆ |
| **Aç±»è¡Œæƒ…æ•°æ®** | 95% | âœ… å®Œæˆ |
| **Bç±»æƒ…æŠ¥æµ** | 90% | âœ… å®Œæˆ |
| **é‡‡é›†ç‚¹é…ç½®** | 100% | âœ… å®Œæˆ |
| **è¡Œæ”¿åŒºåˆ’ç®¡ç†** | 100% | âœ… å®Œæˆ |
| **æå–è§„åˆ™å¼•æ“** | 80% | ğŸ”µ åŸºæœ¬å®Œæˆ |
| **æ–‡æ¡£é‡‡é›† (OCR)** | 20% | ğŸ”´ å¾…å®ç° |
| **è¯­éŸ³é‡‡é›†** | 10% | ğŸ”´ å¾…å®ç° |

---

## âœ… å·²å®ç°åŠŸèƒ½

### 1. æ•°æ®æ¨¡å‹ (Prisma Schema)

å®Œæ•´çš„ Prisma Schema å·²å®šä¹‰ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒè¡¨ï¼š

| æ¨¡å‹ | è¯´æ˜ |
| :--- | :--- |
| `MarketIntel` | å•†æƒ…æƒ…æŠ¥ä¸»è¡¨ |
| `PriceData` | Aç±»ï¼šç»“æ„åŒ–ä»·æ ¼æ•°æ®ï¼ˆä¸‰ç»´åˆ†ç±»ï¼‰ |
| `MarketEvent` | Bç±»ï¼šå¸‚åœºäº‹ä»¶ï¼ˆä»æ—¥æŠ¥æå–ï¼‰ |
| `MarketInsight` | å¸‚åœºæ´å¯Ÿï¼ˆé¢„åˆ¤å’Œåˆ†æï¼‰ |
| `CollectionPoint` | é‡‡é›†ç‚¹é…ç½® |
| `AdministrativeRegion` | è¡Œæ”¿åŒºåˆ’ï¼ˆå›½æ ‡ç¼–ç ï¼‰ |
| `EventTypeConfig` | äº‹ä»¶ç±»å‹é…ç½® |
| `InsightTypeConfig` | æ´å¯Ÿç±»å‹é…ç½® |
| `ExtractionRule` | æå–è§„åˆ™é…ç½® |

**ä»·æ ¼åˆ†ç±»æšä¸¾**:
- `PriceSourceType`: ENTERPRISE / REGIONAL / PORT
- `PriceSubType`: LISTED / TRANSACTION / ARRIVAL / FOB / STATION_ORIGIN / STATION_DEST / PURCHASE / WHOLESALE
- `GeoLevel`: COUNTRY / REGION / PROVINCE / CITY / DISTRICT / PORT / STATION / ENTERPRISE

---

### 2. åç«¯ API (NestJS)

#### æ ¸å¿ƒæœåŠ¡

| æœåŠ¡ | èŒè´£ | æ–¹æ³•æ•° |
| :--- | :--- | :---: |
| `MarketIntelService` | æƒ…æŠ¥CRUDã€äº‹ä»¶/æ´å¯Ÿç®¡ç†ã€æƒ…æŠ¥æµ | 25+ |
| `AIService` | AIå†…å®¹åˆ†æï¼ˆGemini API é›†æˆï¼‰ | 15+ |
| `CollectionPointService` | é‡‡é›†ç‚¹é…ç½®ç®¡ç† | 5+ |
| `AdministrativeRegionService` | è¡Œæ”¿åŒºåˆ’ç®¡ç† | 5+ |
| `ExtractionConfigService` | æå–è§„åˆ™é…ç½® | 5+ |

#### MarketIntelService æ ¸å¿ƒæ–¹æ³•

| æ–¹æ³• | åŠŸèƒ½ |
| :--- | :--- |
| `create()` | åˆ›å»ºæƒ…æŠ¥ï¼Œè‡ªåŠ¨æå–ä»·æ ¼/äº‹ä»¶/æ´å¯Ÿ |
| `batchCreatePriceData()` | æ‰¹é‡å†™å…¥ä»·æ ¼æ•°æ®ï¼ˆå…³è”é‡‡é›†ç‚¹ï¼‰ |
| `batchCreateEvents()` | æ‰¹é‡åˆ›å»ºå¸‚åœºäº‹ä»¶ |
| `batchCreateInsights()` | æ‰¹é‡åˆ›å»ºå¸‚åœºæ´å¯Ÿ |
| `findEvents()` | æŸ¥è¯¢å¸‚åœºäº‹ä»¶ï¼ˆåˆ†é¡µ+ç­›é€‰ï¼‰ |
| `findInsights()` | æŸ¥è¯¢å¸‚åœºæ´å¯Ÿï¼ˆåˆ†é¡µ+ç­›é€‰ï¼‰ |
| `getIntelligenceFeed()` | ç»¼åˆæƒ…æŠ¥æµï¼ˆäº‹ä»¶+æ´å¯Ÿæ··åˆï¼‰ |
| `getEventStats()` | äº‹ä»¶ç»Ÿè®¡ï¼ˆç±»å‹/æƒ…ç»ª/å½±å“åˆ†å¸ƒï¼‰ |
| `getInsightStats()` | æ´å¯Ÿç»Ÿè®¡ |
| `getTrendAnalysis()` | è¶‹åŠ¿åˆ†ææ•°æ® |
| `getHotTopics()` | çƒ­é—¨è¯é¢˜èšåˆ |
| `getFilterOptions()` | åŠ¨æ€ç­›é€‰é€‰é¡¹ |

#### AIService æ ¸å¿ƒæ–¹æ³• (2026-01-22 æ›´æ–°)

| æ–¹æ³• | åŠŸèƒ½ |
| :--- | :--- |
| `analyzeContent()` | åˆ†æå•†æƒ…å†…å®¹ï¼ˆçœŸå® API è°ƒç”¨ï¼‰ |
| `callGeminiAPI()` | è°ƒç”¨ Gemini ä¸­è½¬ API |
| `buildSystemPrompt()` | æŒ‰ç±»åˆ«æ„å»ºç³»ç»Ÿæç¤ºè¯ |
| `buildUserPrompt()` | æŒ‰ç±»åˆ«æä¾›å…·ä½“æŒ‡å¯¼ |
| `enhanceWithAIResponse()` | AI ç»“æœä¸æœ¬åœ°è§£æåˆå¹¶ |
| `mapSourceType()` | æ™ºèƒ½æ¨æ–­ä»·æ ¼ä¸»ä½“ç±»å‹ |
| `mapSubType()` | æ™ºèƒ½æ¨æ–­ä»·æ ¼å­ç±»å‹ |
| `mapGeoLevel()` | æ™ºèƒ½æ¨æ–­åœ°ç†å±‚çº§ |
| `extractPricePoints()` | æœ¬åœ°ä»·æ ¼æå–ï¼ˆé™çº§æ–¹æ¡ˆï¼‰ |
| `analyzeMarketSentiment()` | å¸‚åœºå¿ƒæ€åˆ†æ |
| `extractEvents()` | äº‹ä»¶æå– |
| `extractForecast()` | åå¸‚é¢„åˆ¤æå– |

---

### 3. å‰ç«¯ React Hooks

[hooks.ts](file:///Users/mac/Progame/CTBMS/apps/web/src/features/market-intel/api/hooks.ts) åŒ…å« **137+ å¯¼å‡ºé¡¹**ï¼š

#### æƒ…æŠ¥åŸºç¡€

| Hook | åŠŸèƒ½ |
| :--- | :--- |
| `useMarketIntels` | æƒ…æŠ¥åˆ—è¡¨æŸ¥è¯¢ |
| `useMarketIntel` | å•æ¡æƒ…æŠ¥è¯¦æƒ… |
| `useCreateMarketIntel` | åˆ›å»ºæƒ…æŠ¥ |
| `useAnalyzeContent` | AI åˆ†æ |
| `useMarketIntelStats` | ç»Ÿè®¡æ•°æ® |
| `useLeaderboard` | æ’è¡Œæ¦œ |

#### Aç±»ä»·æ ¼æ•°æ®

| Hook | åŠŸèƒ½ |
| :--- | :--- |
| `usePriceData` | ä»·æ ¼æ•°æ®åˆ—è¡¨ |
| `usePriceTrend` | ä»·æ ¼è¶‹åŠ¿ |
| `usePriceHeatmap` | ä»·æ ¼çƒ­åŠ›å›¾ |
| `usePriceByCollectionPoint` | æŒ‰é‡‡é›†ç‚¹æŸ¥è¯¢ |
| `usePriceByRegion` | æŒ‰è¡Œæ”¿åŒºåˆ’æŸ¥è¯¢ |
| `useMultiPointCompare` | å¤šé‡‡é›†ç‚¹å¯¹æ¯” |

#### Bç±»æƒ…æŠ¥æµ

| Hook | åŠŸèƒ½ |
| :--- | :--- |
| `useMarketEvents` | å¸‚åœºäº‹ä»¶åˆ—è¡¨ |
| `useMarketEvent` | äº‹ä»¶è¯¦æƒ… |
| `useEventStats` | äº‹ä»¶ç»Ÿè®¡ |
| `useMarketInsights` | å¸‚åœºæ´å¯Ÿåˆ—è¡¨ |
| `useMarketInsight` | æ´å¯Ÿè¯¦æƒ… |
| `useInsightStats` | æ´å¯Ÿç»Ÿè®¡ |
| `useIntelligenceFeed` | ç»¼åˆæƒ…æŠ¥æµ |
| `useTrendAnalysis` | è¶‹åŠ¿åˆ†æ |
| `useHotTopics` | çƒ­é—¨è¯é¢˜ |
| `useFilterOptions` | ç­›é€‰é€‰é¡¹ |

#### é…ç½®ç®¡ç†

| Hook | åŠŸèƒ½ |
| :--- | :--- |
| `useCollectionPoints` | é‡‡é›†ç‚¹åˆ—è¡¨ |
| `useRegionTree` | è¡Œæ”¿åŒºåˆ’æ ‘ |
| `useProvinces` | çœä»½åˆ—è¡¨ |

---

### 4. UI ç»„ä»¶

#### ä¸»è¦ç»„ä»¶ (24ä¸ª)

> **2026-01-22 æ›´æ–°**: ç»ä»£ç éªŒè¯ï¼Œç»„ä»¶æ•°é‡å·²æ›´æ­£

**æ–°å¢ç»„ä»¶ï¼ˆæœ¬æ¬¡å®¡æŸ¥å‘ç°ï¼‰**:
- `CollectionConsole.tsx` - é‡‡é›†æ§åˆ¶å°
- `DocumentUploader.tsx` - æ–‡æ¡£ä¸Šä¼ å™¨
- `DailyReportInsight.tsx` - æ—¥æŠ¥æ´å¯Ÿ
- `IntelInsightPanel.tsx` - æƒ…æŠ¥æ´å¯Ÿé¢æ¿
- `IntelligenceFeed.tsx` - æƒ…æŠ¥æµä¸»ç»„ä»¶

| ç»„ä»¶ | åŠŸèƒ½ |
| :--- | :--- |
| `SuperDashboard.tsx` | æ€»è§ˆä»ªè¡¨ç›˜ |
| `Dashboard.tsx` | æ ‡å‡†ä»ªè¡¨ç›˜ |
| `DataEntry.tsx` | ä¿¡æ¯å½•å…¥å…¥å£ |
| `OperationalWorkbench.tsx` | è¿è¥å·¥ä½œå° |
| `UniversalSearch.tsx` | ç»Ÿä¸€æœç´¢ |
| `MarketData.tsx` | Aç±»è¡Œæƒ…æ•°æ®å±•ç¤º |
| `KnowledgeBase.tsx` | çŸ¥è¯†åº“ |
| `EntityProfile.tsx` | å®ä½“æ¡£æ¡ˆ |
| `CollectionPointManager.tsx` | é‡‡é›†ç‚¹ç®¡ç† |
| `CollectionPointEditor.tsx` | é‡‡é›†ç‚¹ç¼–è¾‘å™¨ |
| `RegionManager.tsx` | è¡Œæ”¿åŒºåˆ’ç®¡ç† |
| `RegionCascader.tsx` | åŒºåˆ’çº§è”é€‰æ‹© |
| `AnalyticsDashboard.tsx` | åˆ†æä»ªè¡¨ç›˜ |

#### intel-feed å­æ¨¡å— (14ä¸ªç»„ä»¶)

| ç»„ä»¶ | åŠŸèƒ½ |
| :--- | :--- |
| `IntelFeedDashboard.tsx` | æƒ…æŠ¥æµä»ªè¡¨ç›˜ |
| `AdvancedFilter.tsx` | é«˜çº§å¤šç»´ç­›é€‰ |
| `FeedHeader.tsx` | æƒ…æŠ¥æµå¤´éƒ¨ |
| `RelationPanel.tsx` | å…³è”åˆ†æé¢æ¿ |
| `StatsBar.tsx` | åº•éƒ¨ç»Ÿè®¡æ  |
| `cards/EventCard.tsx` | äº‹ä»¶å¡ç‰‡ |
| `cards/InsightCard.tsx` | æ´å¯Ÿå¡ç‰‡ |
| `cards/DailyReportCard.tsx` | æ—¥æŠ¥å¡ç‰‡ *(æ–°å¢)* |
| `cards/ResearchReportCard.tsx` | ç ”æŠ¥å¡ç‰‡ *(æ–°å¢)* |
| `cards/PolicyDocCard.tsx` | æ”¿ç­–æ–‡æ¡£å¡ç‰‡ *(æ–°å¢)* |
| `views/StreamView.tsx` | ä¿¡æ¯æµè§†å›¾ |
| `views/DashboardView.tsx` | ä»ªè¡¨ç›˜è§†å›¾ |
| `views/TimelineView.tsx` | æ—¶é—´çº¿è§†å›¾ |
| `views/TableView.tsx` | è¡¨æ ¼è§†å›¾ |
| `views/MapView.tsx` | åœ°å›¾è§†å›¾ *(æ–°å¢)* |
| `views/FeedView.tsx` | ä¿¡æ¯æµè§†å›¾ *(æ–°å¢)* |

#### market-data å­æ¨¡å— (6ä¸ªç»„ä»¶)

| ç»„ä»¶ | åŠŸèƒ½ |
| :--- | :--- |
| `AdvancedPointSelector.tsx` | é«˜çº§é‡‡é›†ç‚¹é€‰æ‹©å™¨ |
| `ComparisonPanel.tsx` | å¤šç‚¹å¯¹æ¯”é¢æ¿ |
| `DataGrid.tsx` | æ•°æ®ç½‘æ ¼ |
| `FilterPanel.tsx` | ç­›é€‰é¢æ¿ |
| `TrendChart.tsx` | è¶‹åŠ¿å›¾è¡¨ |
| `InsightCards.tsx` | æ´å¯Ÿå¡ç‰‡ç»„ |

---

## ğŸ”µ è¿›è¡Œä¸­ / éƒ¨åˆ†å®Œæˆ

### 1. æå–è§„åˆ™å¼•æ“

- [x] **æ•°æ®æ¨¡å‹**: `ExtractionRule`ã€`EventTypeConfig`ã€`InsightTypeConfig`
- [x] **åç«¯æœåŠ¡**: `ExtractionConfigService`
- [x] **åŸºç¡€ API**: è§„åˆ™ CRUD
- [ ] **å¯è§†åŒ–ç¼–è¾‘å™¨**: è§„åˆ™å¯è§†åŒ–é…ç½®ç•Œé¢
- [ ] **è§„åˆ™æµ‹è¯•**: è§„åˆ™æ•ˆæœé¢„è§ˆ

### 2. ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ

- [x] **åŸºç¡€ CRUD**: ä»»åŠ¡çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤
- [x] **ä»»åŠ¡å®Œæˆæµç¨‹**: `/tasks/:id/complete`
- [x] **è¶…æ—¶æ£€æµ‹**: `checkOverdueTasks()`
- [ ] **å®šæ—¶ä»»åŠ¡è§¦å‘**: éœ€è¦ cron job è‡ªåŠ¨æ‰§è¡Œ

---

## ğŸ”´ å¾…å®ç°åŠŸèƒ½

| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
| :--- | :--- | :---: |
| **OCR æ–‡æ¡£è¯†åˆ«** | ä¸Šä¼ å›¾ç‰‡/PDF è‡ªåŠ¨æå–æ–‡å­— | ğŸ”´ é«˜ |
| **è¯­éŸ³é‡‡é›†** | è¯­éŸ³è½¬æ–‡å­—ï¼Œæ”¯æŒç°åœºé‡‡é›† | ğŸŸ¡ ä¸­ |
| **GPS å›´æ éªŒè¯** | éªŒè¯é‡‡é›†ä½ç½®çœŸå®æ€§ | ğŸŸ¡ ä¸­ |
| **æ‰¹é‡å¯¼å…¥** | Excel/CSV æ‰¹é‡å¯¼å…¥ä»·æ ¼æ•°æ® | ğŸŸ¡ ä¸­ |

---

## ğŸ“ å…³é”®æ–‡ä»¶ç´¢å¼•

```
å•†æƒ…ä¸­å¿ƒæ™ºèƒ½é‡‡é›†æ¨¡å—
â”œâ”€â”€ åç«¯ (apps/api/src/modules/)
â”‚   â”œâ”€â”€ market-intel/          # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ (11ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ ai/                    # AI æœåŠ¡ (Gemini é›†æˆ)
â”‚   â”œâ”€â”€ collection-point/      # é‡‡é›†ç‚¹é…ç½®
â”‚   â”œâ”€â”€ region/                # è¡Œæ”¿åŒºåˆ’
â”‚   â””â”€â”€ extraction-config/     # æå–è§„åˆ™
â”‚
â”œâ”€â”€ å‰ç«¯ (apps/web/src/features/market-intel/)
â”‚   â”œâ”€â”€ api/hooks.ts           # React Query Hooks (137+)
â”‚   â”œâ”€â”€ components/            # UI ç»„ä»¶ (24ä¸ª)
â”‚   â”‚   â”œâ”€â”€ intel-feed/        # Bç±»æƒ…æŠ¥æµ (14ä¸ª)
â”‚   â”‚   â””â”€â”€ market-data/       # Aç±»è¡Œæƒ… (6ä¸ª)
â”‚   â””â”€â”€ types.ts               # ç±»å‹å¯¼å‡º
â”‚
â”œâ”€â”€ å…±äº«ç±»å‹ (packages/types/src/modules/)
â”‚   â””â”€â”€ market-intel.ts        # Zod Schema & Types
â”‚
â””â”€â”€ æ•°æ®åº“æ¨¡å‹ (apps/api/prisma/)
    â””â”€â”€ schema.prisma          # 1000+ è¡Œ
```

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### çŸ­æœŸ (1-2 å‘¨)

1. ~~**é›†æˆçœŸå® AI API**~~ âœ… **å·²å®Œæˆ (2026-01-22)**
   - å·²é…ç½® Gemini API ä¸­è½¬æœåŠ¡
   - æç¤ºè¯å·²é’ˆå¯¹é¡¹ç›®æ•°æ®ç»“æ„ä¼˜åŒ–

2. **å®Œå–„ OCR èƒ½åŠ›**
   - é›†æˆ OCR æœåŠ¡ï¼ˆå¦‚ Google Vision APIï¼‰
   - åœ¨ `IntelAttachmentService` ä¸­å®ç°å›¾ç‰‡æ–‡å­—æå–

3. **è§„åˆ™å¯è§†åŒ–ç¼–è¾‘å™¨**
   - å®Œå–„æå–è§„åˆ™çš„å¯è§†åŒ–é…ç½®ç•Œé¢

### ä¸­æœŸ (3-4 å‘¨)

4. **ç§»åŠ¨ç«¯é€‚é…**
   - ä¼˜åŒ– DataEntry ç»„ä»¶çš„ç§»åŠ¨ç«¯ä½“éªŒ
   - æ·»åŠ  GPS å®šä½é‡‡é›†èƒ½åŠ›

5. **æ•°æ®è´¨é‡æ ¡éªŒ**
   - ä»·æ ¼å¼‚å¸¸è‡ªåŠ¨æ£€æµ‹
   - å†å²æ•°æ®å¯¹æ¯”å‘Šè­¦

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2026-01-19 09:28*
*æœ€åæ›´æ–°: 2026-01-22*
