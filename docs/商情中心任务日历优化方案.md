# 商情中心任务日历优化方案（细化版，可直接落地）

> 目标：完成方案细化后即可进入实施。

## 1. 现状复盘（用于对齐改造范围）
- 页面：商情中心 → 采集管理 → 任务管理 → 任务日历。
- 当前实现：月/年视图；筛选器（组织/部门/负责人/类型/优先级/状态）；日格子内任务条目；当日抽屉列表；预览任务合并展示。
- 主要问题：
  - 任务量大时，格子内条目渲染过多（性能与可读性问题）。
  - 数据分页截断（只拿 200 条）导致展示/统计不完整。
  - 筛选器缺少快速筛选、保存组合、状态可视化。
  - 当日二级页面功能有限（无批量处理、无高密度展示）。

## 2. 目标拆解
- **信息层级清晰**：月视图只展示分布/密度，详情在二级面板。
- **筛选高效**：支持快捷筛选、筛选标签、保存组合。
- **性能可控**：月视图聚合 + 日详情分页/虚拟列表。
- **交互统一**：保持筛选状态、视图状态一致。

## 3. 设计落地架构（前端）

### 3.1 视图结构
- 顶部工具栏：
  - 视图切换：月 / 周 / 日 / 议程。
  - 时间范围：本周 / 本月 / 自定义。
  - 常用筛选：未完成 / 逾期 / 紧急 / 我负责。
  - 保存筛选（下拉）。
- 主体：
  - 月视图（默认）：热力图/数字徽标。
  - 周/日视图：时间轴布局。
  - 议程视图：分组列表（按日期）。
- 右侧详情面板（可固定/可抽屉）：
  - 日期标题 + 统计小卡。
  - 筛选/排序。
  - 列表（虚拟滚动+分页）。

### 3.2 页面组件拆分
- `TaskCalendarPage`
  - 负责布局 + 视图状态管理。
- `TaskCalendarToolbar`
  - 视图切换/时间范围/快捷筛选。
- `TaskCalendarFilters`
  - 基础筛选 + 高级筛选。
- `TaskCalendarMonthView`
  - 月聚合展示（热力/徽标）。
- `TaskCalendarAgendaView`
  - 按日期分组列表。
- `TaskCalendarDetailPanel`
  - 当日任务列表 + 批量操作。

## 4. 筛选器细化设计

### 4.1 筛选项结构
- **基础筛选**（常驻显示）：
  - 负责人（多选）
  - 状态（多选）
  - 优先级（多选）
  - 类型（多选）
  - 日期范围（本周/本月/自定义）
- **高级筛选**（折叠区域）：
  - 组织 / 部门（级联）
  - 是否逾期
  - 是否预览任务
  - 任务模板
  - 关键词搜索

### 4.2 交互规则
- 筛选结果显示为 Chips，可单独移除。
- 支持保存/加载筛选组合（个人配置）。
- 清空按钮显示“已筛选 X 项”。
- 切换视图时保留筛选条件。

### 4.3 默认筛选策略
- 默认：本月 + 未完成。
- “我的任务”快捷筛选（负责人=当前用户）。

## 5. 交互与二级页面细化

### 5.1 月视图（聚合）
- 每个日期展示：
  - 数字徽标（总数）。
  - 背景热力颜色（按任务数量分级）。
- Hover：展示摘要（完成/逾期/紧急）。
- 点击日期：打开右侧详情面板。

### 5.2 二级详情面板
- 顶部：日期 + 小统计卡（总数/完成/逾期）。
- 快捷过滤：未完成/逾期/紧急。
- 排序：截止时间 / 优先级 / 状态。
- 列表：虚拟滚动 + 分页。
- 批量操作：完成 / 转派 / 导出。

### 5.3 议程视图（列表）
- 按日期分组折叠；支持日期区间。
- 适合任务量大时的快速处理。

## 6. 数据接口设计（细化）

### 6.1 月聚合接口（新增）
- **接口**：`GET /intel-tasks/calendar-summary`
- **参数**：
  - `startDate` / `endDate`
  - `assigneeId` / `assigneeOrgId` / `assigneeDeptId`
  - `status` / `type` / `priority`
  - `includePreview`（是否包含预览任务）
- **返回**：
```json
[
  {
    "date": "2026-02-01",
    "total": 32,
    "completed": 10,
    "overdue": 2,
    "urgent": 5,
    "byType": { "PRICE": 12, "NEWS": 20 },
    "byPriority": { "URGENT": 5, "HIGH": 10, "MEDIUM": 12, "LOW": 5 }
  }
]
```

### 6.2 日详情接口（分页）
- **接口**：`GET /intel-tasks`
- **参数**：
  - `date`（或 `startDate`/`endDate`）
  - `page` / `pageSize`
  - `status` / `priority` / `type` / `assigneeId`
- **返回**：
```json
{
  "data": [
    { "id": "task-1", "title": "任务A", "deadline": "2026-02-01T10:00:00Z", "priority": "HIGH", "status": "PENDING" }
  ],
  "total": 520,
  "page": 1,
  "pageSize": 50
}
```

### 6.3 预览任务
- 预览接口不再合并进月视图列表。
- 仅在聚合接口中体现 `previewCount` 或单独字段。

## 7. 性能优化细化
- 月视图：只渲染聚合数据（31 条以内）。
- 日详情：虚拟列表 + 分页/无限滚动。
- 前端缓存：
  - `staleTime` 2~5 分钟。
  - `keepPreviousData` 防止切月闪烁。
- 后端索引：
  - `(deadline, status)`、`(deadline, assigneeId)`、`(deadline, priority)`。

## 8. 实施拆解（可直接落地）

### 阶段 1：月视图聚合 + 筛选器升级
- 新增后端 `calendar-summary` 接口。
- 前端月视图替换为聚合展示。
- 筛选器改为“基础 + 高级 + 标签化”。

### 阶段 2：当日面板分页 + 批量操作
- 日详情接口分页加载。
- 详情面板增加虚拟滚动 + 批量操作。

### 阶段 3：议程视图
- 增加 Agenda 视图（分组列表）。

### 阶段 4：周/日时间轴视图（可选）
- 适合排期与冲突检查。

## 9. 验收标准
- 月视图切换 < 300ms；
- 单日任务 1000+ 滚动不卡顿；
- 筛选可保存、可复用；
- 数据无截断，聚合与详情一致。

---

> 以上细化完成后，可直接进入落地实施。建议先从 **阶段 1** 开始。
