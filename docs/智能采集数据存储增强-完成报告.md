# æ™ºèƒ½é‡‡é›†æ•°æ®å­˜å‚¨å¢å¼º - Walkthrough

> **å®Œæˆæ—¥æœŸ**: 2026-01-19
> **æœ€åæ›´æ–°**: 2026-01-22
> **æ ¸å¿ƒæ”¹åŠ¨**: æ”¯æŒ C ç±»æ—¥æŠ¥è‡ªåŠ¨è§£æå¹¶æå– A ç±»ä»·æ ¼æ•°æ®å’Œ B ç±»å¸‚åœºå¿ƒæ€

---

## ğŸ“‹ å˜æ›´æ¦‚è§ˆ

æœ¬æ¬¡æ›´æ–°å®ç°äº†ä» **C ç±»æ—¥æŠ¥ï¼ˆ500-1000å­—ï¼‰** ä¸­è‡ªåŠ¨è§£æå¹¶æå– **A ç±»ä»·æ ¼æ•°æ®**ã€**B ç±»å¸‚åœºäº‹ä»¶** å’Œ **å¸‚åœºæ´å¯Ÿ** çš„å®Œæ•´èƒ½åŠ›ã€‚

```mermaid
flowchart LR
    A[Cç±»æ—¥æŠ¥è¾“å…¥] --> B[Gemini AI è§£æ]
    B --> C{è§£æç»“æœ}
    C --> D[pricePoints: Aç±»ä»·æ ¼æ•°æ®]
    C --> E[events: Bç±»å¸‚åœºäº‹ä»¶]
    C --> F[insights: å¸‚åœºæ´å¯Ÿ]
    C --> G[marketSentiment: å¸‚åœºå¿ƒæ€]
    D --> H[è‡ªåŠ¨å†™å…¥ PriceData è¡¨]
    E --> I[è‡ªåŠ¨å†™å…¥ MarketEvent è¡¨]
    F --> J[è‡ªåŠ¨å†™å…¥ MarketInsight è¡¨]
```

---

## ğŸ”§ æ ¸å¿ƒå®ç°

### 1. Gemini API é›†æˆ (2026-01-22)

#### ç¯å¢ƒé…ç½®

```env
GEMINI_API_KEY="your-api-key"
GEMINI_API_URL="https://your-proxy-url/gemini"
GEMINI_MODEL_ID="gemini-2.5-flash"
```

#### AI æœåŠ¡æ–¹æ³•

| æ–¹æ³• | åŠŸèƒ½ |
| :--- | :--- |
| `callGeminiAPI()` | HTTP è°ƒç”¨ä¸­è½¬ APIï¼ˆåŸç”Ÿ fetchï¼‰ |
| `buildSystemPrompt()` | æŒ‰ç±»åˆ«æ„å»ºç³»ç»Ÿæç¤ºè¯ |
| `buildUserPrompt()` | æŒ‰ç±»åˆ«æä¾›å…·ä½“æŒ‡å¯¼ |
| `enhanceWithAIResponse()` | AI ç»“æœä¸æœ¬åœ°è§£æåˆå¹¶ |
| `mapSourceType()` | æ™ºèƒ½æ¨æ–­ä»·æ ¼ä¸»ä½“ç±»å‹ |
| `mapSubType()` | æ™ºèƒ½æ¨æ–­ä»·æ ¼å­ç±»å‹ |
| `mapGeoLevel()` | æ™ºèƒ½æ¨æ–­åœ°ç†å±‚çº§ |

---

### 2. ä»·æ ¼æ•°æ®åˆ†ç±» (Aç±»å¢å¼º)

#### ä¸‰ç»´åˆ†ç±»ä½“ç³»

| ç»´åº¦ | æšä¸¾å€¼ | è¯´æ˜ |
| :--- | :--- | :--- |
| **ä¸»ä½“ç±»å‹** | ENTERPRISE / REGIONAL / PORT | è°çš„ä»·æ ¼ |
| **å­ç±»å‹** | LISTED / TRANSACTION / ARRIVAL / FOB / STATION_ORIGIN / STATION_DEST / PURCHASE / WHOLESALE | ä»€ä¹ˆæ€§è´¨ |
| **åœ°ç†å±‚çº§** | COUNTRY / REGION / PROVINCE / CITY / DISTRICT / PORT / STATION / ENTERPRISE | åœ°ç†ç²’åº¦ |

#### é‡‡é›†ç‚¹å…³è”

- è‡ªåŠ¨åŒ¹é…ç³»ç»Ÿä¸­çš„é‡‡é›†ç‚¹é…ç½®ï¼ˆ`CollectionPoint`ï¼‰
- æ”¯æŒåˆ«ååŒ¹é…å’Œæ¨¡ç³ŠåŒ¹é…
- å…³è”è¡Œæ”¿åŒºåˆ’ä»£ç ï¼ˆ`regionCode`ï¼‰

---

### 3. å¸‚åœºäº‹ä»¶æå– (Bç±»å¢å¼º)

#### MarketEvent æ•°æ®ç»“æ„

| å­—æ®µ | è¯´æ˜ |
| :--- | :--- |
| `subject` | äº‹ä»¶ä¸»ä½“ï¼ˆä¼ä¸š/æ¸¯å£ï¼‰ |
| `action` | åŠ¨ä½œï¼ˆå¼€å§‹æ”¶è´­/åœæœºæ£€ä¿®ç­‰ï¼‰ |
| `content` | å®Œæ•´æè¿° |
| `impact` | å½±å“æè¿° |
| `impactLevel` | HIGH / MEDIUM / LOW |
| `sentiment` | bullish / bearish / neutral |
| `sourceText` | åŸæ–‡ç‰‡æ®µï¼ˆæº¯æºï¼‰ |

---

### 4. å¸‚åœºæ´å¯Ÿæå– (æ–°å¢)

#### MarketInsight æ•°æ®ç»“æ„

| å­—æ®µ | è¯´æ˜ |
| :--- | :--- |
| `title` | æ´å¯Ÿæ ‡é¢˜ |
| `content` | è¯¦ç»†å†…å®¹ |
| `direction` | up / down / stable |
| `timeframe` | short / medium / long |
| `confidence` | 0-100 ç½®ä¿¡åº¦ |
| `factors` | å…³é”®å› ç´ åˆ—è¡¨ |
| `sourceText` | åŸæ–‡ç‰‡æ®µï¼ˆæº¯æºï¼‰ |

---

### 5. å¸‚åœºå¿ƒæ€åˆ†æ

#### MarketSentiment ç»“æ„

| å­—æ®µ | è¯´æ˜ |
| :--- | :--- |
| `overall` | bullish / bearish / neutral / mixed |
| `score` | -100 ~ 100 |
| `traders` | è´¸æ˜“å•†å¿ƒæ€ |
| `processors` | åŠ å·¥ä¼ä¸šå¿ƒæ€ |
| `farmers` | å†œæˆ·/åŸºå±‚å¿ƒæ€ |
| `summary` | å¿ƒæ€æ¦‚è¿° |

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶

### åç«¯

| æ–‡ä»¶ | å˜æ›´ |
| :--- | :--- |
| [ai.service.ts](file:///Users/mac/Progame/CTBMS/apps/api/src/modules/ai/ai.service.ts) | é›†æˆ Gemini APIã€ä¼˜åŒ–æç¤ºè¯ã€æ™ºèƒ½æ˜ å°„æ–¹æ³• |
| [market-intel.service.ts](file:///Users/mac/Progame/CTBMS/apps/api/src/modules/market-intel/market-intel.service.ts) | `batchCreateEvents()`ã€`batchCreateInsights()` |
| [price-data.service.ts](file:///Users/mac/Progame/CTBMS/apps/api/src/modules/market-intel/price-data.service.ts) | ä»·æ ¼æ•°æ®æœåŠ¡ *(2026-01-22 è¡¥å……)* |
| [research-report.service.ts](file:///Users/mac/Progame/CTBMS/apps/api/src/modules/market-intel/research-report.service.ts) | ç ”æŠ¥æœåŠ¡ *(2026-01-22 è¡¥å……)* |
| [document-parser.service.ts](file:///Users/mac/Progame/CTBMS/apps/api/src/modules/market-intel/document-parser.service.ts) | æ–‡æ¡£è§£ææœåŠ¡ *(2026-01-22 è¡¥å……)* |
| [schema.prisma](file:///Users/mac/Progame/CTBMS/apps/api/prisma/schema.prisma) | MarketEventã€MarketInsight æ¨¡å‹ |

### ç±»å‹å®šä¹‰

| æ–‡ä»¶ | å˜æ›´ |
| :--- | :--- |
| [market-intel.ts](file:///Users/mac/Progame/CTBMS/packages/types/src/modules/market-intel.ts) | ExtractedPricePointSchemaã€MarketSentimentSchemaã€ForecastSchema |

---

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### æ—¥æŠ¥é‡‡é›†æµç¨‹

1. è®¿é—® `/intel/entry` é¡µé¢
2. é€‰æ‹© **C ç±»ï¼šæ–‡æ¡£ä¸å›¾è¡¨**
3. ç²˜è´´æ—¥æŠ¥å…¨æ–‡
4. ç‚¹å‡»ã€AI åˆ†æä¸æ ¡éªŒã€‘
5. æŸ¥çœ‹è§£æç»“æœï¼š
   - **ä»·æ ¼æ•°æ® (Aç±»)**: æŒ‰ä¸»ä½“ç±»å‹åˆ†ç»„å±•ç¤º
   - **å¸‚åœºäº‹ä»¶ (Bç±»)**: äº‹ä»¶åˆ—è¡¨
   - **å¸‚åœºæ´å¯Ÿ**: é¢„åˆ¤åˆ†æ
   - **å¸‚åœºå¿ƒæ€**: æƒ…ç»ªåˆ¤å®š
6. ç¡®è®¤åç‚¹å‡»ã€ç¡®è®¤å…¥åº“ã€‘

### æ•°æ®æµå‘

```
ç”¨æˆ·ç²˜è´´æ—¥æŠ¥
    â†“
POST /market-intel/analyze (Gemini API)
    â†“
AI è§£æè¿”å› {
    pricePoints: [...],
    events: [...],
    insights: [...],
    marketSentiment: {...}
}
    â†“
ç”¨æˆ·ç¡®è®¤æäº¤
    â†“
POST /market-intel
    â†“
1. å†™å…¥ MarketIntel è¡¨
2. è‡ªåŠ¨å†™å…¥ PriceData è¡¨ï¼ˆå…³è”é‡‡é›†ç‚¹ï¼‰
3. è‡ªåŠ¨å†™å…¥ MarketEvent è¡¨
4. è‡ªåŠ¨å†™å…¥ MarketInsight è¡¨
```

---

## âœ… éªŒè¯ç»“æœ

| é¡¹ç›® | çŠ¶æ€ |
| :--- | :---: |
| Gemini API é›†æˆ | âœ… |
| TypeScript ç¼–è¯‘ | âœ… |
| ä»·æ ¼åˆ†ç±»å­˜å‚¨ | âœ… |
| äº‹ä»¶/æ´å¯Ÿæå– | âœ… |

---

## ğŸ”® åç»­è¿­ä»£å»ºè®®

1. ~~**é›†æˆçœŸå® AI API**~~ âœ… **å·²å®Œæˆ (2026-01-22)**

2. **ä»·æ ¼æ•°æ®æ‰‹åŠ¨ç¼–è¾‘**
   - å…è®¸ç”¨æˆ·åœ¨æäº¤å‰ä¿®æ”¹/åˆ é™¤é”™è¯¯çš„ä»·æ ¼ç‚¹
   
3. **ä¼ä¸šè‡ªåŠ¨å…³è”**
   - ä»æ—¥æŠ¥ä¸­è¯†åˆ«çš„ä¼ä¸šåç§°è‡ªåŠ¨å…³è”åˆ° `Enterprise` è¡¨

4. **å†å²æ—¥æŠ¥æ‰¹é‡å¯¼å…¥**
   - æ”¯æŒ Excel/CSV æ‰¹é‡å¯¼å…¥å†å²æ•°æ®

---

*Walkthrough ç”Ÿæˆæ—¶é—´: 2026-01-19*
*æœ€åæ›´æ–°: 2026-01-22*
