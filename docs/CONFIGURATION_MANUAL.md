
# 🛠️ GMIDSS 系统配置与运维手册

> **最后更新**: 2026-01-26
> **适用版本**: v1.2 (AI Calibration Enhanced)

本文档详细说明了商情与价格系统的后台配置机制、生效原理及最佳实践。

---

## 1. 采集点配置 (Collection Point Config)

采集点是行情的物理载体（如：锦州港、通威股份）。

### 1.1 核心字段作用
*   **名称 (Name)**: 标准名称，显示在报表中。
*   **别名 (Aliases)**: **最关键字段**。AI 依靠别名来识别非标文本。
    *   *示例*: 为“锦州港”配置别名 `["锦港", "锦州新港", "Jinzhou Port"]`。
*   **默认配置 (Default Config)**: 当 AI 无法从文本中识别具体类型时，使用的兜底值。
    *   `defaultSubType`: 建议港口设为 `FOB`，深加工设为 `PURCHASE`。

### 1.2 热重载机制 (Hot Reload)
*   **缓存策略**: **5分钟自动刷新**。
*   **生效时效**:
    *   **数据库**: 修改后立即写入，列表查询立即生效。
    *   **AI 识别**: 系统每 5 分钟检查一次变更。如果您刚刚添加了一个新别名，**最多等待 5 分钟**，AI 即可识别它。
    *   *注*: 无需重启服务。

---

## 2. 业务映射规则 (Business Mapping Rules)

这是 AI 用于判断“价格类型”、“情感方向”和“地理层级”的大脑。

### 2.1 规则类型
系统包含 4 大类规则：
1.  **价格来源 (PRICE_SOURCE_TYPE)**: 判断是 `PORT`(港口) 还是 `ENTERPRISE`(企业)。
    *   *规则示例*: 包含“粮库” -> `ENTERPRISE`。
2.  **价格子类型 (PRICE_SUB_TYPE)**: 判断是 `LISTED`(挂牌) 还是 `NET`(净粮)。
    *   *规则示例*: 包含“平舱” -> `FOB`。
3.  **地理层级 (GEO_LEVEL)**: 判断是 `CITY`(市) 还是 `PROVINCE`(省)。
4.  **情感分析 (SENTIMENT)**: 判断 `POSITIVE`(看涨) 或 `NEGATIVE`(看跌)。

### 2.2 热重载机制
*   **API/后台修改**: **立即生效 (Instant)**。
    *   通过管理后台开关规则或修改关键词，AI 引擎会毫秒级更新逻辑。
*   **数据库直改**: 不推荐。如果直接修改 SQL，需要重启服务才能生效。

---

## 3. 商情中心提取规则 (Market Extraction Rules)

用于从长文本中提取“事件”和“洞察”的高级规则（左词+连接符+右词）。

### 3.1 缓存机制
*   **缓存策略**: **5分钟自动刷新**。
*   **说明**: 这一点与采集点类似。修改复杂的提取公式后，AI 分析服务会在后台静默更新，稍等片刻即可生效。

---

## 4. 故障排查与运维

### 4.1 常见问题：修改后 AI 不生效
1.  **检查生效延迟**: 是否在 5 分钟缓冲期内？
2.  **检查规则优先级**: 是否被更高优先级的规则覆盖了？（例如“锦州”既匹配城市也匹配港口，看谁的 Priority 高）。
3.  **强制刷新**: 如果急需生效，重启后端 API 服务 (`pnpm start:api`) 是最快的方法。

### 4.2 性能说明
当前的“5分钟验证缓存”机制经过优化，对数据库的负载影响极小（纳秒级），在包含数千个采集点和规则的高并发场景下依然保持稳定。

---

**End of Manual.**
